<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.10/dist/clipboard.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.4.9/jscolor.min.js"></script>
    <script src="https://colorjs.io/dist/color.global.js"></script>
    <style>
        body {
            background: #313f64;
        }
        #preview {
            background: #1f204f;
            color: #aabfdf;
            padding: 8px 12px;
            min-height: 254px;
            display: block;
        }
        input, textarea {
            border-color: #212248 !important;
        }
        h1, h2 {
            color: #aabfdf;
            margin: 20px 0;
        }
        [data-jscolor] {
            border-width: 1px;
            border-color: #aabfdf !important;
        }
        .form-control {
            border-width: 1px;
            border-color: #aabfdf !important;
        }
        .char-button {
            margin: 4px 4px 4px 0;
            width: 40px;
        }
        .emote-button {
            font-size: 20px;
            padding: 0 4px;
            margin: 0 4px 4px 0;
            width: 35px;
        }
        #single-generate {
            height: 40px;
            line-height: 26px;
        }
        #single-color {
            border-radius: 6px 0 0 6px;
        }
        .character-count {
            color: #aabfdf;
            padding: 6px 10px;
            font-style: italic;
        }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZST9R8QK4X"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-ZST9R8QK4X');
    </script>
</head>
<body>
<div class="container">
    <h1>The Couleuratator &trade;</h1>
    <div class="row">
        <div class="col-6">
            <div class="row">
                <div class="col">
                    <textarea id="raw-code" class="form-control" rows="10" cols="54" wrap="hard"></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <button class="btn btn-primary float-end" data-clipboard-target="#raw-code">Copy</button>
                    <span class="float-end character-count"><span id="character-count">0</span> / 1000</span>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div id="preview"></div>
        </div>
    </div>
    <div class="row">
        <div class="input-group">
            <input id="single-color" value="#aabfdfff" data-jscolor="{}" />
            <button id="single-generate" class="btn btn-primary"><i class="fa fa-plus"></i></button>
        </div>
    </div>
    <div class="row">
        <div class="col-6">
            <button class="char-button btn btn-light" data-char="[B]"><b>B</b></button>
            <button class="char-button btn btn-light" data-char="[I]"><i>I</i></button>
            <button class="char-button btn btn-light" data-char="[U]"><u>U</u></button>
            <button class="char-button btn btn-light" data-char="[S]"><s>S</s></button>
        </div>
    </div>
    <div class="row">
        <div class="col-6" id="emotes">
        </div>
        <div class="col-6" id="ascii">
        </div>
    </div>
    <div class="row">
        <h2><br />Gradient</h2>
    </div>
    <div class="row">
        <div class="col-5">
            <div class="input-group">
                <span class="input-group-text">De</span>
                <input id="gradient-start" value="#aabfdfff" data-jscolor="{}" />
            </div>
            <div class="input-group">
                <span class="input-group-text">À</span>
                <input id="gradient-end" value="#aabfdfff" data-jscolor="{}" />
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-8">
            <div class="input-group">
                <span class="input-group-text">Texte</span>
                <input id="gradient-text" class="form-control" type="text" />
                <button id="gradient-generate" class="btn btn-primary">Fais péter</button>
            </div>
        </div>
    </div>
</div>

<script>
  jscolor.presets.default = {
    format:'hexa',
    required: false,
  };

    $(function() {
      const preview = $('#preview')[0];
      const raw = $('#raw-code')[0];
      const count = $('#character-count')[0];
      const maxLineLength = 54;

      const colorRegexp = /\[([0-9a-fA-F]{8})\]([^[\n]*)/gi;
      const fontRegexp = /\[([IUBS])\]/gi;
      const emoteRegexp = /(\[\#\d\d\])/gi;

      const baseColor = '#aabfdf';
      const baseColorFull = '[' + baseColor.replace('#', '') + 'ff]';
      const clipboard = new ClipboardJS('.btn');
      const emotes = {
        '[#01]': '💦',
        '[#02]': '💥',
        '[#03]': '💔',
        '[#04]': '🍻',
        '[#05]': '🌹',
        '[#06]': '❤',
        '[#07]': '😀',
        '[#08]': '😭',
        '[#09]': '😌',
        '[#10]': '😵',
        '[#11]': '😋',
        '[#12]': '😂',
        '[#13]': '😄',
        '[#14]': '😫',
        '[#15]': '😁',
        '[#16]': '😃',
        '[#17]': '😰',
        '[#18]': '😢',
        '[#19]': '😳',
        '[#20]': '😤',
        '[#21]': '🌚',
        '[#22]': '😣',
        '[#23]': '😯',
        '[#24]': '😡',
        '[#25]': '😠',
        '[#26]': '😟',
        '[#27]': '😞',
        '[#28]': '😝',
        '[#29]': '😈',
        '[#30]': '😚',
        '[#31]': '😘',
        '[#32]': '😗',
        '[#33]': '😖',
        '[#34]': '🙁',
        '[#35]': '😔',
        '[#36]': '😇',
        '[#37]': '😴',
        '[#38]': '😓',
        '[#39]': '😒',
        '[#40]': '😑',
        '[#41]': '🔥',
        '[#42]': '😏',
        '[#43]': '😎',
        '[#44]': '😍',
        '[#45]': '💋',
        '[#46]': '✨',
        '[#47]': '🎂',
        '[#48]': '❓',
        '[#49]': '🐷',
        '[#50]': '😊',
        '[#51]': '😃',
        '[#52]': '☺',
        '[#53]': '😉',
        '[#54]': '😜',
        '[#55]': '😨',
        '[#56]': '😱',
        '[#57]': '😪',
        '[#58]': '😷',
        '[#59]': '💤',
        '[#60]': '🎵',
        '[#61]': '💩',
        '[#62]': '👍',
        '[#63]': '👎',
        '[#65]': '👊',
        '[#66]': '✊',
        '[#67]': '✌',
        '[#68]': '👋',
        '[#69]': '✋',
        '[#70]': '👐',
        '[#71]': '👇',
        '[#72]': '👆',
        '[#73]': '👉',
        '[#74]': '👈',
        '[#75]': '🙌',
        '[#76]': '🙏',
        '[#77]': '☝',
        '[#78]': '👏',
        '[#79]': '💪',
        '[#80]': '👩‍❤️‍👨',
        '[#81]': '👩‍❤️‍💋‍👨',
        '[#82]': '🌹',
        '[#83]': '👀',
        '[#84]': '👌',
      };
      const ascii = '█▌▐░▒▓▒░◢◣◥◤↑↓←→↖↗↙↘△▲▽▼▶▷◀◁①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳ⒶⒷⒸⒹⒺⒻⒼⒽⒾⒿⓀⓁⓂⓃⓄⓅⓆⓇⓈⓉⓊⓋⓌⓍⓎⓏⓐⓑⓒⓓⓔⓕⓖⓗⓘⓙⓚⓛⓜⓝⓞⓟⓠⓡⓢⓣⓤⓥⓦⓧⓨⓩ';

      let i = 0;
      $.each(emotes, function (char, icon) {
        $('#emotes').append('<button class="btn btn-sm btn-light emote-button" data-char="' + char + '">' + icon + '</button>');
        if ((++i % 10) == 0) $('#emotes').append('<br>');
      });
      i = 0;
      $.each(ascii.split(''), function (index, char) {
        $('#ascii').append('<button class="btn btn-sm btn-light char-button" data-char="' + char + '">' + char + '</button>');
        if ((++i % 10) == 0) $('#ascii').append('<br>');
      });

      function checkLineLength(text) {
        const lines = $(raw).val().split("\n");
        const lastLine = lines.length > 0 ? lines[lines.length - 1] : null;

        if ((lastLine.length + text.length) > maxLineLength) {
          $(raw).val($(raw).val() + "\n");
        }
      }

      function appendText(text) {
        checkLineLength(text);

        $(raw).val($(raw).val() + text);
        $(raw).trigger('change');
        $(raw).focus();
      }

      function  updatePreview() {
        $(preview).html(
          $(raw).val()
            .replaceAll(colorRegexp, '<span style="color: #$1;">$2</span>')
            .replaceAll(fontRegexp, '<$1>')
            .replaceAll(emoteRegexp, (match) => emotes[match])
            .replaceAll(/\n/g, '</i></b></u></s><br>')
        );
        $(count).html($(raw).val().length);
      }

      $(raw).on('keyup change', function(event) {
        updatePreview();
      });

      $('body').on('click', '.char-button, .emote-button', function() {
        appendText($(this).data('char'));
      })

      $('#single-generate').on('click', () => {
        const code = $('#single-color').val().replace('#', '');
        appendText('[' + code + ']');
      })

      $('#gradient-generate').on('click', () => {
        const start = new Color($('#gradient-start').val());
        const end = new Color($('#gradient-end').val());
        const text = $('#gradient-text').val();
        const textSize = text.length;

        if (textSize <= 0) {
          return;
        }

        const diff = {
          red: {
            start: parseInt(start.srgb.r * 255),
            end: parseInt(end.srgb.r * 255),
            step: parseInt((end.srgb.r - start.srgb.r) * 255 / textSize),
          },
          green: {
            start: parseInt(start.srgb.g * 255),
            end: parseInt(end.srgb.g * 255),
            step: parseInt((end.srgb.g - start.srgb.g) * 255 / textSize),
          },
          blue: {
            start: parseInt(start.srgb.b * 255),
            end: parseInt(end.srgb.b * 255),
            step: parseInt((end.srgb.b - start.srgb.b) * 255 / textSize),
          },
        }

        let rendered = '';
        for (let i = 0; i < textSize; i++) {
          const red = Number(diff.red.start + diff.red.step * i).toString(16).padStart(2, '0');
          const green = Number(diff.green.start + diff.green.step * i).toString(16).padStart(2, '0');
          const blue = Number(diff.blue.start + diff.blue.step * i).toString(16).padStart(2, '0');

          rendered += '[' + red + green + blue + 'FF]' + text[i];
        }

        rendered += baseColorFull;

        appendText(rendered);
      });
    })
</script>
</body>
</html>
