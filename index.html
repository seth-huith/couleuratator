<html>
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" />
    <script src="https://code.jquery.com/jquery-3.6.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.10/dist/clipboard.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.4.9/jscolor.min.js"></script>
    <script src="https://colorjs.io/dist/color.global.js"></script>
    <style>
        body {
            background: #313f64;
        }
        #preview {
            background: #1f204f;
            color: #aabfdf;
            padding: 8px 12px;
            min-height: 254px;
            display: block;
        }
        input, textarea {
            border-color: #212248 !important;
        }
        h1, h2 {
            color: #aabfdf;
            margin: 20px 0;
        }
        [data-jscolor] {
            border-width: 1px;
            border-color: #aabfdf !important;
        }
        .form-control {
            border-width: 1px;
            border-color: #aabfdf !important;
        }
        .char-button {
            margin: 4px 4px 4px 0;
            width: 40px;
        }
        .emote-button {
            font-size: 20px;
            padding: 0 4px;
            margin: 0 4px 4px 0;
            width: 35px;
        }
        #single-generate {
            height: 40px;
            line-height: 26px;
        }
        #single-color {
            border-radius: 6px 0 0 6px;
        }
        .character-count {
            color: #aabfdf;
            padding: 6px 10px;
            font-style: italic;
        }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZST9R8QK4X"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-ZST9R8QK4X');
    </script>
</head>
<body>
<div class="container">
    <h1>The Couleuratator &trade;</h1>
    <div class="row">
        <div class="col-6">
            <div class="row">
                <div class="col">
                    <textarea id="raw-code" class="form-control" rows="10" cols="54" wrap="hard"></textarea>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <button class="btn btn-primary float-end" data-clipboard-target="#raw-code">Copy</button>
                    <span class="float-end character-count"><span id="character-count">0</span> / 1000</span>
                </div>
            </div>
        </div>
        <div class="col-6">
            <div id="preview"></div>
        </div>
    </div>
    <div class="row">
        <div class="input-group">
            <input id="single-color" value="#aabfdfff" data-jscolor="{}" />
            <button id="single-generate" class="btn btn-primary"><i class="fa fa-plus"></i></button>
        </div>
    </div>
    <div class="row">
        <div class="col-6">
            <button class="char-button btn btn-light" data-char="[B]"><b>B</b></button>
            <button class="char-button btn btn-light" data-char="[I]"><i>I</i></button>
            <button class="char-button btn btn-light" data-char="[U]"><u>U</u></button>
            <button class="char-button btn btn-light" data-char="[S]"><s>S</s></button>
        </div>
    </div>
    <div class="row">
        <div class="col-6" id="emotes">
        </div>
        <div class="col-6" id="ascii">
        </div>
    </div>
    <div class="row">
        <h2><br />Gradient</h2>
    </div>
    <div class="row">
        <div class="col-5">
            <div class="input-group">
                <span class="input-group-text">De</span>
                <input id="gradient-start" value="#aabfdfff" data-jscolor="{}" />
            </div>
            <div class="input-group">
                <span class="input-group-text">Ã€</span>
                <input id="gradient-end" value="#aabfdfff" data-jscolor="{}" />
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-8">
            <div class="input-group">
                <span class="input-group-text">Texte</span>
                <input id="gradient-text" class="form-control" type="text" />
                <button id="gradient-generate" class="btn btn-primary">Fais pÃ©ter</button>
            </div>
        </div>
    </div>
</div>

<script>
  jscolor.presets.default = {
    format:'hexa',
    required: false,
  };

    $(function() {
      const preview = $('#preview')[0];
      const raw = $('#raw-code')[0];
      const count = $('#character-count')[0];
      const maxLineLength = 54;

      const colorRegexp = /\[([0-9a-fA-F]{8})\]([^[\n]*)/gi;
      const fontRegexp = /\[([IUBS])\]/gi;
      const emoteRegexp = /(\[\#\d\d\])/gi;

      const baseColor = '#aabfdf';
      const baseColorFull = '[' + baseColor.replace('#', '') + 'ff]';
      const clipboard = new ClipboardJS('.btn');
      const emotes = {
        '[#01]': 'ğŸ’¦',
        '[#02]': 'ğŸ’¥',
        '[#03]': 'ğŸ’”',
        '[#04]': 'ğŸ»',
        '[#05]': 'ğŸŒ¹',
        '[#06]': 'â¤',
        '[#07]': 'ğŸ˜€',
        '[#08]': 'ğŸ˜­',
        '[#09]': 'ğŸ˜Œ',
        '[#10]': 'ğŸ˜µ',
        '[#11]': 'ğŸ˜‹',
        '[#12]': 'ğŸ˜‚',
        '[#13]': 'ğŸ˜„',
        '[#14]': 'ğŸ˜«',
        '[#15]': 'ğŸ˜',
        '[#16]': 'ğŸ˜ƒ',
        '[#17]': 'ğŸ˜°',
        '[#18]': 'ğŸ˜¢',
        '[#19]': 'ğŸ˜³',
        '[#20]': 'ğŸ˜¤',
        '[#21]': 'ğŸŒš',
        '[#22]': 'ğŸ˜£',
        '[#23]': 'ğŸ˜¯',
        '[#24]': 'ğŸ˜¡',
        '[#25]': 'ğŸ˜ ',
        '[#26]': 'ğŸ˜Ÿ',
        '[#27]': 'ğŸ˜',
        '[#28]': 'ğŸ˜',
        '[#29]': 'ğŸ˜ˆ',
        '[#30]': 'ğŸ˜š',
        '[#31]': 'ğŸ˜˜',
        '[#32]': 'ğŸ˜—',
        '[#33]': 'ğŸ˜–',
        '[#34]': 'ğŸ™',
        '[#35]': 'ğŸ˜”',
        '[#36]': 'ğŸ˜‡',
        '[#37]': 'ğŸ˜´',
        '[#38]': 'ğŸ˜“',
        '[#39]': 'ğŸ˜’',
        '[#40]': 'ğŸ˜‘',
        '[#41]': 'ğŸ”¥',
        '[#42]': 'ğŸ˜',
        '[#43]': 'ğŸ˜',
        '[#44]': 'ğŸ˜',
        '[#45]': 'ğŸ’‹',
        '[#46]': 'âœ¨',
        '[#47]': 'ğŸ‚',
        '[#48]': 'â“',
        '[#49]': 'ğŸ·',
        '[#50]': 'ğŸ˜Š',
        '[#51]': 'ğŸ˜ƒ',
        '[#52]': 'â˜º',
        '[#53]': 'ğŸ˜‰',
        '[#54]': 'ğŸ˜œ',
        '[#55]': 'ğŸ˜¨',
        '[#56]': 'ğŸ˜±',
        '[#57]': 'ğŸ˜ª',
        '[#58]': 'ğŸ˜·',
        '[#59]': 'ğŸ’¤',
        '[#60]': 'ğŸµ',
        '[#61]': 'ğŸ’©',
        '[#62]': 'ğŸ‘',
        '[#63]': 'ğŸ‘',
        '[#65]': 'ğŸ‘Š',
        '[#66]': 'âœŠ',
        '[#67]': 'âœŒ',
        '[#68]': 'ğŸ‘‹',
        '[#69]': 'âœ‹',
        '[#70]': 'ğŸ‘',
        '[#71]': 'ğŸ‘‡',
        '[#72]': 'ğŸ‘†',
        '[#73]': 'ğŸ‘‰',
        '[#74]': 'ğŸ‘ˆ',
        '[#75]': 'ğŸ™Œ',
        '[#76]': 'ğŸ™',
        '[#77]': 'â˜',
        '[#78]': 'ğŸ‘',
        '[#79]': 'ğŸ’ª',
        '[#80]': 'ğŸ‘©â€â¤ï¸â€ğŸ‘¨',
        '[#81]': 'ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘¨',
        '[#82]': 'ğŸŒ¹',
        '[#83]': 'ğŸ‘€',
        '[#84]': 'ğŸ‘Œ',
      };
      const ascii = 'â–ˆâ–Œâ–â–‘â–’â–“â–’â–‘â—¢â—£â—¥â—¤â†‘â†“â†â†’â†–â†—â†™â†˜â–³â–²â–½â–¼â–¶â–·â—€â—â‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨â‘©â‘ªâ‘«â‘¬â‘­â‘®â‘¯â‘°â‘±â‘²â‘³â’¶â’·â’¸â’¹â’ºâ’»â’¼â’½â’¾â’¿â“€â“â“‚â“ƒâ“„â“…â“†â“‡â“ˆâ“‰â“Šâ“‹â“Œâ“â“â“â“â“‘â“’â““â“”â“•â“–â“—â“˜â“™â“šâ“›â“œâ“â“â“Ÿâ“ â“¡â“¢â“£â“¤â“¥â“¦â“§â“¨â“©';

      let i = 0;
      $.each(emotes, function (char, icon) {
        $('#emotes').append('<button class="btn btn-sm btn-light emote-button" data-char="' + char + '">' + icon + '</button>');
        if ((++i % 10) == 0) $('#emotes').append('<br>');
      });
      i = 0;
      $.each(ascii.split(''), function (index, char) {
        $('#ascii').append('<button class="btn btn-sm btn-light char-button" data-char="' + char + '">' + char + '</button>');
        if ((++i % 10) == 0) $('#ascii').append('<br>');
      });

      function checkLineLength(text) {
        const lines = $(raw).val().split("\n");
        const lastLine = lines.length > 0 ? lines[lines.length - 1] : null;

        if ((lastLine.length + text.length) > maxLineLength) {
          $(raw).val($(raw).val() + "\n");
        }
      }

      function appendText(text) {
        checkLineLength(text);

        $(raw).val($(raw).val() + text);
        $(raw).trigger('change');
        $(raw).focus();
      }

      function  updatePreview() {
        $(preview).html(
          $(raw).val()
            .replaceAll(colorRegexp, '<span style="color: #$1;">$2</span>')
            .replaceAll(fontRegexp, '<$1>')
            .replaceAll(emoteRegexp, (match) => emotes[match])
            .replaceAll(/\n/g, '</i></b></u></s><br>')
        );
        $(count).html($(raw).val().length);
      }

      $(raw).on('keyup change', function(event) {
        updatePreview();
      });

      $('body').on('click', '.char-button, .emote-button', function() {
        appendText($(this).data('char'));
      })

      $('#single-generate').on('click', () => {
        const code = $('#single-color').val().replace('#', '');
        appendText('[' + code + ']');
      })

      $('#gradient-generate').on('click', () => {
        const start = new Color($('#gradient-start').val());
        const end = new Color($('#gradient-end').val());
        const text = $('#gradient-text').val();
        const textSize = text.length;

        if (textSize <= 0) {
          return;
        }

        const diff = {
          red: {
            start: parseInt(start.srgb.r * 255),
            end: parseInt(end.srgb.r * 255),
            step: parseInt((end.srgb.r - start.srgb.r) * 255 / textSize),
          },
          green: {
            start: parseInt(start.srgb.g * 255),
            end: parseInt(end.srgb.g * 255),
            step: parseInt((end.srgb.g - start.srgb.g) * 255 / textSize),
          },
          blue: {
            start: parseInt(start.srgb.b * 255),
            end: parseInt(end.srgb.b * 255),
            step: parseInt((end.srgb.b - start.srgb.b) * 255 / textSize),
          },
        }

        let rendered = '';
        for (let i = 0; i < textSize; i++) {
          const red = Number(diff.red.start + diff.red.step * i).toString(16).padStart(2, '0');
          const green = Number(diff.green.start + diff.green.step * i).toString(16).padStart(2, '0');
          const blue = Number(diff.blue.start + diff.blue.step * i).toString(16).padStart(2, '0');

          rendered += '[' + red + green + blue + 'FF]' + text[i];
        }

        rendered += baseColorFull;

        appendText(rendered);
      });
    })
</script>
</body>
</html>
